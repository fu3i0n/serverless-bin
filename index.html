<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#e879f9" />
    <meta
      name="description"
      content="DaisyPaste - Fast, modern, and beautiful pastebin service with syntax highlighting"
    />
    <meta
      name="keywords"
      content="pastebin, code sharing, syntax highlighting, DaisyPaste, paste, code"
    />
    <meta name="author" content="DaisyPaste" />
    <meta name="robots" content="noindex,nofollow" />

    <!-- Performance and SEO -->
    <meta name="generator" content="DaisyPaste" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />

    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192.png" />

    <!-- Windows Tile -->
    <meta name="msapplication-TileColor" content="#e879f9" />
    <meta name="msapplication-TileImage" content="/icons/icon-144.png" />

    <title>DaisyPaste</title>

    <!-- Stylesheets with preload for critical CSS -->
    <link
      rel="preload"
      href="application.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript><link rel="stylesheet" href="application.css" /></noscript>
    <link rel="stylesheet" href="syntax-theme.css" />

    <!-- Scripts with improved loading -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="application.js"></script>

    <script>
      // Modern initialization script for DaisyPaste
      var app = null;

      // Handle popstate events for navigation
      var handlePop = function (evt) {
        var path = evt.target.location.pathname;
        if (path === '/') {
          if (app) app.newDocument(true);
        } else {
          if (app) app.loadDocument(path.substring(1));
        }
      };

      // Initialize app when DOM is ready
      document.addEventListener('DOMContentLoaded', function () {
        // Wait for hljs to be available
        var initApp = function () {
          if (typeof hljs === 'undefined') {
            setTimeout(initApp, 50);
            return;
          }

          // Register service worker for offline capabilities
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker
              .register('/sw.js')
              .then(function (registration) {
                console.log('Service Worker registered:', registration);
              })
              .catch(function (error) {
                console.warn('Service Worker registration failed:', error);
              });
          }

          // Initialize DaisyPaste application
          try {
            app = new DaisyPaste('DaisyPaste', {
              twitter: true,
              theme: 'gradient-purple-pink',
              autoSave: false,
              autoSaveDelay: 2000,
            });
            handlePop({ target: window });

            // Set up popstate handler after initial load
            setTimeout(function () {
              window.addEventListener('popstate', function (evt) {
                try {
                  handlePop(evt);
                } catch (err) {
                  console.warn('Navigation error:', err);
                }
              });
            }, 100);
          } catch (error) {
            console.error('Failed to initialize DaisyPaste:', error);
          }
        };

        initApp();
      });
    </script>
  </head>

  <body>
    <!-- Loading indicator -->
    <div id="loading" class="loading-spinner" aria-hidden="true">
      <div class="spinner"></div>
    </div>

    <!-- Toast notifications -->
    <div id="messages" class="toast-container" role="alert" aria-live="polite"></div>

    <!-- Main toolbar -->
    <header id="toolbar" class="toolbar" role="banner">
      <div class="toolbar-section brand">
        <a href="/" class="logo" aria-label="DaisyPaste Home">
          <span class="logo-text">DaisyPaste</span>
        </a>
      </div>

      <nav class="toolbar-section actions">
        <button
          class="btn btn-primary save function"
          data-action="save"
          aria-label="Save document (Ctrl+S)"
        >
          <span class="btn-icon">üíæ</span>
          <span class="btn-text">Save</span>
        </button>
        <button
          class="btn btn-secondary new function"
          data-action="new"
          aria-label="New document (Ctrl+N)"
        >
          <span class="btn-icon">üìÑ</span>
          <span class="btn-text">New</span>
        </button>
        <button
          class="btn btn-secondary duplicate function"
          data-action="duplicate"
          aria-label="Duplicate & Edit (Ctrl+D)"
        >
          <span class="btn-icon">üìã</span>
          <span class="btn-text">Duplicate</span>
        </button>
        <button
          class="btn btn-secondary raw function"
          data-action="raw"
          aria-label="View raw text (Ctrl+Shift+R)"
        >
          <span class="btn-icon">üìù</span>
          <span class="btn-text">Raw</span>
        </button>
        <button
          class="btn btn-secondary twitter function"
          data-action="twitter"
          aria-label="Share on Twitter (Ctrl+Shift+T)"
        >
          <span class="btn-icon">üê¶</span>
          <span class="btn-text">Share</span>
        </button>
      </nav>

      <!-- Tooltip for button descriptions -->
      <div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true">
        <div class="tooltip-content">
          <div class="tooltip-label"></div>
          <div class="tooltip-shortcut"></div>
        </div>
        <div class="tooltip-arrow"></div>
      </div>
    </header>

    <!-- Main content area -->
    <main class="editor-container">
      <!-- Line numbers -->
      <div id="linenos" class="line-numbers" aria-hidden="true">&gt;</div>

      <!-- Code display -->
      <pre
        id="box"
        class="code-display hljs"
        style="display: none"
        tabindex="0"
        role="textbox"
        aria-label="Code display"
      ><code></code></pre>

      <!-- Text editor -->
      <textarea
        id="editor"
        class="code-editor"
        spellcheck="false"
        placeholder="Start typing or paste your code here..."
        aria-label="Code editor"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="off"
        autofocus
      ></textarea>
    </main>

    <!-- Keyboard shortcuts help (hidden by default) -->
    <div id="shortcuts-help" class="shortcuts-panel" aria-hidden="true">
      <div class="shortcuts-content">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcuts-list">
          <div class="shortcut-item">
            <kbd>Ctrl + S</kbd>
            <span>Save document</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl + N</kbd>
            <span>New document</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl + D</kbd>
            <span>Duplicate & edit</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl + Shift + R</kbd>
            <span>View raw text</span>
          </div>
          <div class="shortcut-item">
            <kbd>Ctrl + Shift + T</kbd>
            <span>Share on Twitter</span>
          </div>
          <div class="shortcut-item">
            <kbd>?</kbd>
            <span>Show/hide shortcuts</span>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
